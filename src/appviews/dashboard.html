<!DOCTYPE html>
<html>
	<head>
		<title>Scms dashboard</title>
		<style>
			.article {
				margin: 5px;
				border: 1px solid lightgrey;
			}
			.delet {
				color: blue;
			}
		</style>
	</head>
	<body>
		<h1>Scms dashboard</h1>
		<a href="editor.html">New article</a>
		<p>These are your current articles:</p>
		<div id="articles"></div>
		<script>
			fetch("/api/articles").then(r => r.json()).then(articles => {
				articles.forEach(article => {
					let newDiv = document.createElement("div");
					newDiv.className = "article";
					newDiv.id = article.id;
					let title = document.createElement("p");
					title.innerText = article.title;
					newDiv.innerHTML += `<a href="/article/${article.id}"><b>${title.innerHTML}</b></a>`;
					let date = (new Date(article.date * 86400000)).toDateString();
					newDiv.innerHTML += ` (${date}) - <a href='editeditor.html?id=${article.id}'>Edit</a> | <a class="delet" href='#' onClick='delet(this)'>Delete</a>`;
					document.getElementById("articles").appendChild(newDiv);
				});
			});
			function delet(el) {
				if (!confirm("Are you sure you would like to delete this article?")) return;
				fetch("/app/delete", {
					method: "POST",
					body: JSON.stringify({
						id: el.parentNode.id
					}),
					credentials: "same-origin",
					headers: {"Content-Type": "application/json"}
				}).then(r => r.text()).then(r => {
					if (r === "true") {
						alert("Article successfully deleted");
						window.location.reload();
					} else alert("There was a problem deleting this article");
				});
			}
		</script>
	</body>
</html>
